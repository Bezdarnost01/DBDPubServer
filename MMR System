**Полное описание MMR-системы «капли → MMR» 0–3000 для Dead by Daylight (2018) с учётом эмблем и бонуса «одинокого» выжившего**

---

## 1. Общие параметры системы

* **Диапазон MMR:** от **0** до **3000**.
* **Стартовый MMR:** **0** (новый игрок начинает «с чистого листа»).
* **K-фактор командного матча:**

  $$
    K_{\rm team} = 32 \times 4 = 128.
  $$
* **Делитель в формуле Elo:** **400** (стандартное значение, при желании можно менять для большей чувствительности).

---

## 2. Формулы Elo-прогноза

1. **Средний MMR выживших** (чтобы сравнить 4 vs 1):

   $$
     \overline{MMR}_{\rm surv} = \frac{MMR_1 + MMR_2 + MMR_3 + MMR_4}{4}.
   $$
2. **Ожидаемая вероятность победы выживших**:

   $$
     E_{\rm surv}
     = \frac{1}{1 + 10^{\frac{MMR_{\rm killer} - \overline{MMR}_{\rm surv}}{400}}}.
   $$
3. **Ожидаемая вероятность победы убийцы**:

   $$
     E_{\rm killer} = 1 - E_{\rm surv}.
   $$

---

## 3. Определение результата $R$ по эмблемам

1. Считаем число выживших с эмблемой **Unbroken** качества **Gold+**.
2. Правила:

   * **≥ 3** таких выжившихся → победа **выживших** $\;R_{\rm surv}=1$.
   * **≤ 1** → победа **убийцы** $\;R_{\rm surv}=0$.
   * **Ровно 2** → смотрим эмблему **Devout** у убийцы:

     * Devout ≥ Gold → $R_{\rm surv}=0$.
     * Иначе → $R_{\rm surv}=1$.
3. Для убийцы $R_{\rm killer} = 1 - R_{\rm surv}.$

---

## 4. Расчёт изменения MMR

1. **Общее изменение команды выживших**:

   $$
     \Delta_{\rm team} = K_{\rm team}\,\bigl(R_{\rm surv} - E_{\rm surv}\bigr).
   $$

2. **Изменение убийцы**:

   $$
     \Delta_{\rm killer} = -\,\Delta_{\rm team}.
   $$

3. **Распределение $\Delta_{\rm team}$ между выжившими**
   Для каждого выжившего i:

   * Вычисляем **Performance Score** — суммарную «полезность» его 4 эмблем (см. § 5).
   * Веса:

     $$
       w_i = \frac{\text{Perf}_i}{\sum_{j=1}^4 \text{Perf}_j}.
     $$
   * Тогда изменение:

     $$
       \Delta_i = \Delta_{\rm team} \times w_i.
     $$

4. **Бонус «одинокому»**
   Если **единственный выживший** доказал высокую полезность (Perfᵢ ≥ порога), то:

   * Он получает дополнительный **B** баллов (например, 2 или 3).
   * Убийца теряет те же **B** баллов.

5. **Ограничение границ**
   После вычислений:

   $$
     \text{new\_MMR} = \min\!\bigl(\max(MMR_{\rm old} + \Delta,\,0),\,3000\bigr).
   $$

---

## 5. Подсчёт Performance Score (Perfᵢ)

Каждую из 4 эмблем оцениваем баллами (например):

* **Bronze** = 1
* **Silver** = 2
* **Gold** = 3
* **Platinum** = 4
* **Iridescent** = 5

**Пример**
Если у выжившего эмблемы

> Unbroken = Gold (3), Devout = Platinum (4), Altruism = Silver (2), Objectives = Iridescent (5),
> то

$$
\text{Perf} = 3 + 4 + 2 + 5 = 14.
$$

*(Опционально можно ввести веса для разных эмблем, но для простоты используется прямая сумма.)*

---

## 6. Полные расчёты: пример A («команда выжила»)

**Входные данные**

* MMR убийцы: **1600**
* MMR выживших: **\[1200, 1300, 1400, 1500]**
* Perf выживших: **\[3, 4, 5, 2]**
* Результат: выжившие побеждают → $R_{\rm surv}=1$.
* Нет «одинокого» → бонус B=0.

|   Шаг  |                             Формула / расчёт                             |                Значение               |
| :----: | :----------------------------------------------------------------------: | :-----------------------------------: |
| **1.** | $\displaystyle \overline{MMR}_{\rm surv}=\tfrac{1200+1300+1400+1500}{4}$ |                  1350                 |
| **2.** |       $\displaystyle E_{\rm surv}=\frac{1}{1+10^{(1600-1350)/400}}$      |            $\approx0{,}192$           |
| **3.** |                 $\Delta_{\rm team}=128\times(1-0{,}192)$                 |           $\approx+103{,}46$          |
| **4.** |                      $\Delta_{\rm killer}=-103{,}46$                     |                   –                   |
| **5.** |                          Сумма Perf = 3+4+5+2=14                         |                   –                   |
| **6.** |  Веса $w=[3/14,4/14,5/14,2/14]\approx[0{,}214,0{,}286,0{,}357,0{,}143]$  |                   –                   |
| **7.** |                       $\Delta_i = 103.46\times w_i$                      |     \[22.17, 29.56, 36.95, 14.78]     |
| **8.** |                          **Новые MMR выживших**:                         | \[1222.17, 1329.56, 1436.95, 1514.78] |
|        |                   **Новый MMR убийцы**: $1600 - 103.46$                  |                1496.54                |

---

## 7. Полные расчёты: пример B («один выжил»)

**Входные данные**

* MMR убийцы: **1500**
* MMR выживших: **\[800, 1000, 1100, 1200]**
* Perf выживших: **\[2, 3, 5, 4]**
* Победа выживших → $R_{\rm surv}=1$.
* Лишь четвёртый выжил → одиночный бонус **B=3**.

|   Шаг   |                   Формула / расчёт                   |      Значение     |
| :-----: | :--------------------------------------------------: | :---------------: |
|  **1.** |  $\overline{MMR}_{\rm surv}=(800+1000+1100+1200)/4$  |        1025       |
|  **2.** |       $E_{\rm surv}=1/(1+10^{(1500-1025)/400})$      |  $\approx0{,}061$ |
|  **3.** |       $\Delta_{\rm team}=128\times(1-0{,}061)$       | $\approx+120{,}2$ |
|  **4.** |            $\Delta_{\rm killer}=-120{,}2$            |         –         |
|  **5.** |                Сумма Perf = 2+3+5+4=14               |         –         |
|  **6.** |          Веса $w=[0.143,0.214,0.357,0.286]$          |         –         |
|  **7.** |    Базовые Δ выживших = \[17.2, 25.7, 42.9, 34.4]    |         –         |
|  **8.** | Но выжил только 4-й: он получает $120.2 + 3 = 123.2$ |         –         |
|  **9.** |       Убийца штрафуется на $120.2 + 3 = 123.2$       |         –         |
| **10.** |        **Новый MMR 4-го выжившего:** 1200→1323       |         –         |
|         |            **Новый MMR убийцы:** 1500→1377           |         –         |

---

